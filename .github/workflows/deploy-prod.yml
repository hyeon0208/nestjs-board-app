name: ğŸ“Š Deploy Production

on:
  workflow_call:

jobs:
  deploy:
    name: ìš´ì˜í™˜ê²½ ë°°í¬
    runs-on: ubuntu-latest
    environment: prod
    steps:
    - name: í™˜ê²½ ì •ë³´ ì¶œë ¥
      run: |
        echo "âš ï¸ ìš´ì˜í™˜ê²½ ë°°í¬ ì‹œì‘"
        echo "í˜„ì¬ ì‹œê°„: $(date)"
        
    - name: Environment Secrets í…ŒìŠ¤íŠ¸
      run: |
        echo "=== Secrets ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ==="
        echo "DATABASE_URL ê¸¸ì´: ${#DATABASE_URL}"
        echo "API_KEY ê¸¸ì´: ${#API_KEY}"
        
        # ì²« 3ê¸€ìë§Œ ì¶œë ¥í•´ì„œ ì‹¤ì œ ê°’ í™•ì¸
        if [ -n "$DATABASE_URL" ]; then
        echo "DATABASE_URL ì• 3ê¸€ì: ${DATABASE_URL:0:3}..."
        fi
        
        if [ -n "$API_KEY" ]; then
        echo "API_KEY ì• 3ê¸€ì: ${API_KEY:0:3}..."
        fi
        
        # í™˜ê²½ë³€ìˆ˜ ì „ì²´ ëª©ë¡ì—ì„œ í™•ì¸
        echo "=== í™˜ê²½ë³€ìˆ˜ ëª©ë¡ì—ì„œ SECRET ê´€ë ¨ í™•ì¸ ==="
        env | grep -E "(DATABASE|API)" || echo "ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ ì—†ìŒ"

      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        API_KEY: ${{ secrets.API_KEY }}
        
    - name: Environment Variables í…ŒìŠ¤íŠ¸
      run: |
        echo "=== Prod Environment Variables ==="
        echo "LOG_LEVEL: ${{ vars.LOG_LEVEL }}"
        echo "PORT: ${{ vars.PORT }}"
        
    - name: ìš´ì˜í™˜ê²½ ë°°í¬ ì‹œë®¬ë ˆì´ì…˜
      run: |
        echo "ğŸš€ ìš´ì˜ ì„œë²„ ë°°í¬ ì¤‘..."
        sleep 3
        echo "âœ… ìš´ì˜í™˜ê²½ ë°°í¬ ì™„ë£Œ!"