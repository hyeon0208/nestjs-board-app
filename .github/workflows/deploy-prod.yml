name: 📊 Deploy Production

on:
  workflow_call:

jobs:
  deploy:
    name: 운영환경 배포
    runs-on: ubuntu-latest
    environment: prod
    steps:
    - name: 환경 정보 출력
      run: |
        echo "⚠️ 운영환경 배포 시작"
        echo "현재 시간: $(date)"
        
    - name: Environment Secrets 테스트
      run: |
        echo "=== Secrets 존재 여부 확인 ==="
        echo "DATABASE_URL 길이: ${#DATABASE_URL}"
        echo "API_KEY 길이: ${#API_KEY}"
        
        # 첫 3글자만 출력해서 실제 값 확인
        if [ -n "$DATABASE_URL" ]; then
        echo "DATABASE_URL 앞 3글자: ${DATABASE_URL:0:3}..."
        fi
        
        if [ -n "$API_KEY" ]; then
        echo "API_KEY 앞 3글자: ${API_KEY:0:3}..."
        fi
        
        # 환경변수 전체 목록에서 확인
        echo "=== 환경변수 목록에서 SECRET 관련 확인 ==="
        env | grep -E "(DATABASE|API)" || echo "관련 환경변수 없음"

      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
        API_KEY: ${{ secrets.API_KEY }}
        
    - name: Environment Variables 테스트
      run: |
        echo "=== Prod Environment Variables ==="
        echo "LOG_LEVEL: ${{ vars.LOG_LEVEL }}"
        echo "PORT: ${{ vars.PORT }}"
        
    - name: 운영환경 배포 시뮬레이션
      run: |
        echo "🚀 운영 서버 배포 중..."
        sleep 3
        echo "✅ 운영환경 배포 완료!"